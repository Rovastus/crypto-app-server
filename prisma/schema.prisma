generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_WITH_SCHEMA")
}

model Portpholio {
  id            BigInt          @id @default(autoincrement()) @db.BigInt
  name          String          @unique
  taxMethod     TaxMethod
  fiat          Fiat
  exports       Export[]
  wallet        Wallet[]
  walletHistory WalletHistory[]
}

model Export {
  id           BigInt        @id @default(autoincrement()) @db.BigInt
  name         String        @unique
  jsonData     String
  portpholioId BigInt
  portpholio   Portpholio    @relation(fields: [portpholioId], references: [id])
  deposit      Deposit[]
  earn         Earn[]
  transaction  Transaction[]
  transfer     Transfer[]
  withdraw     Withdraw[]
}

model Wallet {
  id              BigInt     @id @default(autoincrement()) @db.BigInt
  coin            String
  amount          Decimal    @db.Decimal(65, 8)
  avcoFiatPerUnit Decimal    @db.Decimal(65, 8)
  totalFiat       Decimal    @db.Decimal(65, 8)
  portpholioId    BigInt
  portpholio      Portpholio @relation(fields: [portpholioId], references: [id])

  @@unique([portpholioId, coin], name: "portpholioId_coin_unique")
}

model WalletHistory {
  id                 BigInt     @id @default(autoincrement()) @db.BigInt
  coin               String
  oldAmount          Decimal    @db.Decimal(65, 8)
  oldAvcoFiatPerUnit Decimal    @db.Decimal(65, 8)
  oldTotalFiat       Decimal    @db.Decimal(65, 8)
  newAmount          Decimal    @db.Decimal(65, 8)
  newAvcoFiatPerUnit Decimal    @db.Decimal(65, 8)
  newTotalFiat       Decimal    @db.Decimal(65, 8)
  time               DateTime
  portpholioId       BigInt
  portpholio         Portpholio @relation(fields: [portpholioId], references: [id])
}

model Deposit {
  id       BigInt   @id @default(autoincrement()) @db.BigInt
  amount   Decimal  @db.Decimal(65, 8)
  coin     String
  time     DateTime
  exportId BigInt
  export   Export   @relation(fields: [exportId], references: [id])
}

model Withdraw {
  id       BigInt   @id @default(autoincrement()) @db.BigInt
  time     DateTime
  amount   Decimal  @db.Decimal(65, 8)
  coin     String
  exportId BigInt
  export   Export   @relation(fields: [exportId], references: [id])
}

model Transaction {
  id                  BigInt                @id @default(autoincrement()) @db.BigInt
  buy                 Decimal               @db.Decimal(65, 8)
  buyCoin             String
  price               Decimal               @db.Decimal(65, 8)
  priceCoin           String
  fee                 Decimal               @db.Decimal(65, 8)
  feeCoin             String
  time                DateTime
  exportId            BigInt
  export              Export                @relation(fields: [exportId], references: [id])
  transactionTaxEvent TransactionTaxEvent[]
}

model TransactionTaxEvent {
  id             BigInt                  @id @default(autoincrement()) @db.BigInt
  type           TransactionTaxEventType
  gainInFiat     Decimal                 @db.Decimal(65, 8)
  expensesInFiat Decimal                 @db.Decimal(65, 8)
  transactionId  BigInt
  transaction    Transaction             @relation(fields: [transactionId], references: [id])
}

model Transfer {
  id       BigInt   @id @default(autoincrement()) @db.BigInt
  fee      Decimal  @db.Decimal(65, 8)
  feeCoin  String
  time     DateTime
  exportId BigInt
  export   Export   @relation(fields: [exportId], references: [id])
}

model Earn {
  id         BigInt   @id @default(autoincrement()) @db.BigInt
  amount     Decimal  @db.Decimal(65, 8)
  amountCoin String
  time       DateTime
  exportId   BigInt
  export     Export   @relation(fields: [exportId], references: [id])
}

model CoinPairPriceHistory {
  id         BigInt   @id @default(autoincrement()) @db.BigInt
  time       DateTime
  price      Decimal  @db.Decimal(65, 8)
  url        String
  coinPairId BigInt
  coinPair   CoinPair @relation(fields: [coinPairId], references: [id])

  @@unique([time, coinPairId], name: "time_coinPairId_unique")
}

model CoinPair {
  id               BigInt                 @id @default(autoincrement()) @db.BigInt
  pair             String                 @unique
  pairPriceHistory CoinPairPriceHistory[]
}

enum TaxMethod {
  AVCO
}

enum Fiat {
  EUR
}

enum TransactionTaxEventType {
  FEE
  BUY
}
